class BinComb{constructor(e){this.keywords=e,this.comb=e.length}get_combinations(){var e="0".repeat(this.comb),t=e,n={};for(let e=1;e<this.comb+1;e++)n[e]=[];for(let r=0;r<2**this.comb-1;r++){t=(parseInt(t,2)+parseInt("1",2)).toString(2);let r="0".repeat(e.length-t.length)+t;n[(r.match(/1/g)||[]).length].push(r)}var r=[];return Object.keys(n).forEach((e=>{var t=n[e],a=[];t.forEach((e=>{var t=[];for(let n=0;n<e.length;n++){this.keywords[n].repeat(parseInt(e[n],2)).length>0&&t.push(this.keywords[n].repeat(parseInt(e[n],2)))}a.push(t.join("&"))})),r.push(a.join("|"))})),r.reverse(),r}}var r;init_reddit();var example_message=$(".message").clone().removeClass("visually-hidden"),example_reply=$(".reply").clone().removeClass("visually-hidden"),typing=$(".typing").clone().removeClass("visually-hidden");async function compute(){var e=["[removed]","[deleted]",""," "],t=$("#subreddit").val();if(!t.length)return void $("#subreddit").focus();var n=$("#query").val();if(!n.length)return void $("#query").focus();$("#query").val("");let a=example_message.clone();$(a).find(".message-content").text(n),$("#chat").append(a),$("#chat").append(typing);var o=[],i=[],s=n.split(" "),l=new BinComb(s).get_combinations();for(search of l){i.push([]);var d=(await search_comments(search,t)).data,c=[];for(comment of d){if(c.length>500)break;e.includes(comment.body)||(comment.body.split(" ").length>=3*s.length||o.includes(comment)||c.push(comment))}if(i[l.indexOf(search)]=i[l.indexOf(search)].concat(c),o=o.concat(c),c.length>2)break}for(result of i){var h=!1;if(result.length>0)for(var m=0;0!=result.length&&!(m>=result.length);){if(h=result[Math.floor(Math.random()*result.length)],(u=await r.getComment(h.id).expandReplies({limit:1/0,depth:1/0}).then((e=>e.replies))).length>=1)break;result.splice(result.indexOf(h),1),h=!1,m+=1}if(h)break}if(h){var p=[],u=await r.getComment(h.id).expandReplies({limit:1/0,depth:1/0}).then((e=>e.replies));for(reply of u)e.includes(reply.body)||p.push(reply.body);$(".typing").remove();let t=example_reply.clone();$(t).find(".message-content").text(p[Math.floor(Math.random()*p.length)]),$("#chat").append(t)}else{$(".typing").remove();let e=example_reply.clone();$(e).find(".message-content").text("Sorry, couldn't find anything to write :("),$("#chat").append(e)}}async function init_reddit(){r=await reddit(),$("#send-button").removeClass("disabled"),$("#send-button").removeAttr("disabled")}async function reddit(){let e=await window.snoowrap.fromApplicationOnlyAuth({userAgent:"Fake AI App",clientId:"kUS9GmssIeklQae6FxicTQ",deviceId:random_id(),redirectUri:"https://fakeai.buzl.uk/"}).then((e=>e));return e}async function screenshot(){html2canvas($("#page-card")[0],{logging:!1}).then((e=>{var t=e.toDataURL("image/png").replace("image/png","image/octet-stream");$("#output").attr("href",t),$("#output").attr("download","fakeai-"+(new Date).getTime()+".png"),document.getElementById("output").click(),e.remove()}))}function random_id(){return(Math.random()+1).toString(16).substring(2)+(Math.random()+1).toString(16).substring(2)}function search_comments(e,t){return fetch("https://api.pushshift.io/reddit/search/comment/?size=200&fields=author,body,id&q="+encodeURIComponent(e)+"&subreddit="+encodeURIComponent(t),{method:"GET"}).then((e=>!!e.ok&&e.json()))}$(document).on("keypress",(function(e){var t=e.target.tagName.toLowerCase();"q"==e.key&&"body"==t&&$("#query").focus()})),$("#query").on("keyup",(function(e){"Enter"==e.key&&compute()}));